name: Flow test

on:
  issue_comment:
    types:
      - created

jobs:
  job1:
    runs-on: ubuntu-latest
    if: ${{ github.event.issue.pull_request && contains(github.event.comment.body, '/run-flow') }} 
    outputs:
      output1: ${{ steps.step1.outputs.test }}
      output2: ${{ steps.step2.outputs.test }}
    steps:
      - id: step1
        run: echo "test=hello" >> "$GITHUB_OUTPUT"
      - id: step2
        run: echo "test=world" >> "$GITHUB_OUTPUT"
  job2:
    runs-on: ubuntu-latest
    needs: job1
    outputs:
      output_inside: ${{ steps.pass.outputs.test }}
    steps:
      - name: setup branch 
        uses: actions/checkout@v3
        with:
          ref: 'test/cicd'
      - name: setup node
        uses: actions/setup-node@v3
        with:
          node-version: 16
      - name: pass
        id: pass
        env:
          OUTPUT1: ${{needs.job1.outputs.output1}}
          OUTPUT2: ${{needs.job1.outputs.output2}}
        run: |
          echo "$OUTPUT1 $OUTPUT2" 
          sh scripts/flow.sh
          node scripts/flow.js
      - name: receive
        run: | 
          echo ${{ steps.pass.outputs.test }}
          echo ${{ steps.pass.outputs.message }}
          echo ${{ steps.pass.outputs.js }}
